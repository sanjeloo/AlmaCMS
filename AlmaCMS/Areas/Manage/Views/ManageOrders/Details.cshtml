@model IEnumerable<AlmaCMS.ViewModels.VMOrderProductSite>

@{
    ViewBag.Title = "Details";
    Layout = "~/Areas/Manage/Views/Shared/_LayoutAdmin.cshtml";
}

<link href="~/Areas/Manage/Content/css/alertify.rtl.min.css" rel="stylesheet" />
<link href="~/Scripts/jquery-ui.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery-3.1.1.js"></script>
<script src="~/ckeditor/ckeditor.js"></script>
<script src="~/ckeditor/adapters/jquery.js"></script>
@{
    var orderinfo = ViewBag.OrderInfo as AlmaCMS.ViewModels.VMOrderList;
}
<style>
     .filterpr {
        background-color: #ededed;
        border: 1px solid #ccc;
        border-radius: 3px;
     
        
        padding: 6px;
    }
     form{margin-bottom:0px;}
</style>
<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading clearfix">
                <h4 class="panel-title">جزئیات سفارش</h4>
                <ul class="panel-tool-options">
                    <li><a data-rel="collapse" href="#"><i class="icon-down-open"></i></a></li>
                    <li><a data-rel="reload" href="#"><i class="icon-arrows-ccw"></i></a></li>
                    <li><a href="/AdminShop/ManageOrders"><i class="icon-left"></i></a></li>
                    <li><a data-rel="close" href="#"><i class="icon-cancel"></i></a></li>
                </ul>
            </div>
            <div class="panel-body">
                <div class="col-xs-12 filterpr" style="">
                    <div class="">
                        <div class="col-xs-12 col-md-7 col-lg-7">
                            <div class="form-group">
                                <label class="control-label col-md-4" style="padding-top:6px;">ثبت وضعیت سفارش : </label>

                                @using (Html.BeginForm("ChangeState", "ManageOrders"))
                                {
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="OrderID" value="@orderinfo.id" />
                                    <div class="col-md-5">
                                        <select class="form-control" name="statusID" id="ddlStatuses">

                                            @foreach (var item in ViewBag.StatusList as List<AlmaCMS.Models.OrderStatus>)
                                            {
                                                <option value="@item.id">
                                                    @item.Title
                                                </option>
                                            }
                                        </select>
                                    </div>
                                    <div class="col-xs-12 col-md-3" style="padding-left:0px">
                                        <button id="btnfilter" class="btn btn-blue btn-block btn-add"><i class="fa fa-filter"></i> ثبت</button>
                                    </div>
                                }
                            </div>

                        </div>

                    </div>
                </div>

                <div class="clearfix"></div>
                <div class="row">
                   
                    <div class="col-md-12">
                        <div id="PrintFactor">
                            <div style="background-color:lavender;border:solid 1px #ccc;border-bottom:0px;">
                                @*<div style="float:right;width:36%;padding:15px 15px 0 15px;">
                                    <span style="font-size:12px;display:block;padding-top:8px;">
                                        نام خریدار : @orderinfo.Name
                                    </span>
                                    <span style="font-size:12px;display:block;padding-top:8px;">
                                        <span style="padding-left:30px;">تلفن ثابت : @orderinfo.Tel</span>
                                        <span>موبایل : @orderinfo.Mobile</span>
                                    </span>
                                    <span style="font-size:12px;display:block;padding-top:8px;">
                                        کد پستی : @orderinfo.PstalCode
                                    </span>
                                    <span style="font-size:12px;;padding-top:8px;">
                                        استان : @orderinfo.StateTitle - 
                                    </span>
                                    <span style="font-size:12px;padding-top:8px;">
                                        شهر : @orderinfo.CityTitle - 
                                    </span>
                                    <span style="font-size:12px;padding-top:8px;">
                                        آدرس : @orderinfo.Address
                                    </span>
                                </div>
                                <div style="float:right;width:28%;margin:0 2%;text-align:center;padding-top:15px;">
                                    <b>فاکتور فروش اینترنتی اتوکارن</b>
                                    <p style="margin:20px 0 0 0">http://otokaren.com</p>
                                </div>
                                <div style="float:right;width:32%;padding:6px 0 0 15px">
                                    <div style="text-align:left;display:block">
                                        <img src="~/Content/image/logo/logo-dark.png" style="height:30px;margin: 10px 0 12px;" />
                                    </div>
                                    <div class="clear"></div>
                                    <span style="text-align: left;font-size:12px;padding-top:5px;display:block">
                                        شماره فاکتور : @orderinfo.id
                                    </span>
                                    <div class="clear"></div>
                                    <span style="float: left;font-size:12px;padding-top:5px;">
                                        شماره پیگیری : @orderinfo.TrackingID
                                    </span>
                                </div>*@
                                <div class="row">
                                    <div class="col-md-4 col-xs-12" >

                                        <span style="font-size:12px;display:block;padding-top:8px;margin-right:10px;">
                                            نام خریدار : @orderinfo.Name
                                        </span>
                                        <span style="font-size:12px;display:block;padding-top:8px;margin-right:10px;">
                                            <span style="padding-left:30px;">تلفن ثابت : @orderinfo.Tel</span>
                                            <span>موبایل : @orderinfo.Mobile</span>
                                        </span>
                                        <span style="font-size:12px;display:block;padding-top:8px;margin-right:10px;">
                                            کد پستی : @orderinfo.PstalCode
                                        </span>
                                     
                                  
                                     
                                        <span style="font-size:12px;padding-top:8px;margin-right:10px;">
                                            استان : @orderinfo.StateTitle -
                                        </span>
                                        <span style="font-size:12px;padding-top:8px;margin-right:10px;">
                                            شهر : @orderinfo.CityTitle -
                                        </span>
                                        <span style="font-size:12px;padding-top:8px;margin-right:10px;">
                                            آدرس : @orderinfo.Address
                                        </span>
                                        
                                    </div>
                                    <div class="col-md-4  col-xs-12">
                                        <b>فاکتور فروش پی یو اس نظری</b>
                                        <p style="margin:20px 0 0 0">http://pusnazari.com</p>

                                    </div>
                                    <div class="col-md-4  col-xs-12">

                                        <div style="text-align:left;display:block;margin-left:10px">
                                            <img src="/content/site/images/logo.png" style="height:30px;margin: 10px 0 12px;" />
                                        </div>
                                        <div class="clear"></div>
                                        <span style="text-align: left;font-size:12px;padding-top:5px;display:block;margin-left:10px">
                                            شماره فاکتور : @orderinfo.id
                                        </span>
                                        <div class="clear"></div>
                                        <span style="float: left;font-size:12px;padding-top:5px;margin-left:10px;">
                                            شماره پیگیری : @orderinfo.TrackingID
                                        </span>

                                    </div>
                                </div>


                            </div>
                            <table dir="rtl" id="hpsupportTable" cellpadding="5" border="1" cellspacing="0" width="100%" style="margin-bottom:0px;" class="table table-striped table-bordered table-hover dataTables-example dataTable no-footer">
                                <thead>
                                    <tr>
                                        <th style="width:50px;">
                                            ردیف
                                        </th>
                                        @*<th>
                                            پیشنهاد های تامین کنندگان
                                        </th>*@
                                        <th>
                                            شرح محصول
                                        </th>
                                        <th style="text-align:center;">
                                            تعداد
                                        </th>
                                        <th style="width:128px;">
                                            قیمت واحد <span style="font-size:10px;">(تومان)</span>
                                        </th>
                                        <th data-hide="phone,tablet" style="width:129px;">
                                            قیمت کل <span style="font-size:10px;">(تومان)</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ int i = 0; }
                                    @foreach (var item in Model)
                                    {
                                        i++;
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                @i
                                            </td>
                                            @*<td>
                                                <a onclick="OpenPopUp(@item.ProductID);" data-toggle="tooltip"> <i class="fa fa-list" aria-hidden="true"></i></a> 

                                            </td>*@
                                            <td>
                                                <img height="30" src="@item.Image" style="margin:0 15px;" />
                                                @item.Title
                                                <span style="font-size:10px; margin-right:10px" >@item.BrandTitle </span>
                                          
                                            </td>
                                            <td style="vertical-align: middle;text-align:center;">
                                                @item.Quantity
                                            </td>
                                            <td style="vertical-align: middle;text-align:center;">
                                                <span class="nsprice">@item.Price</span>
                                            </td>
                                            <td style="vertical-align: middle;text-align:center;">
                                                <span class="nsprice">@(item.Quantity * item.Price)</span>
                                            </td>
                                        </tr>
                                    }

                                </tbody>
                            </table>

                            <table dir="rtl" id="hpsupportTable" cellpadding="5" border="1" cellspacing="0" style="width:27%;float:left;" class="table table-striped table-bordered table-hover dataTables-example dataTable no-footer">
                                <tbody>
                                    <tr>
                                        <td style="width:115px;">
                                            جمع کل خرید شما :
                                        </td>
                                        <td style="width:115px;text-align:center;">
                                            <span class="nsprice">@(orderinfo.TotalPrice - orderinfo.SendPrice)</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            هزینه ارسال :
                                        </td>
                                        <td style="width:115px;text-align:center;">
                                            <span class="nsprice">@orderinfo.SendPrice</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            مبلغ قابل پرداخت :
                                        </td>
                                        <td style="width:115px;text-align:center;">
                                           
                                            <span class="nsprice">@orderinfo.TotalPrice</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                
            </div>
        </div>
    </div>
</div>
<div id="PriceBox" class="modal fade" tabindex="-1" role="dialog" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
         
            </div>
            <div class="modal-body">
                <p>
                    <div >
                        <table class="table table-striped table-bordered table-hover dataTables-example dataTable no-footer">
                            <thead>
                                <tr>
                                  
                                  
                                    <th>نام تامین کننده</th>
                                    <th>نام خانوادگی تامین کننده</th>
                                    <th>نام شرکت تامین کننده</th>
                               
                                    <th>شماره موبایل</th>

                                    <th>قیمت پیشنهادی</th>



                                </tr>
                            </thead>
                            <tbody id=OffersTable>
                            
                            </tbody>
                        </table>
                    </div>
                </p>
                <div class="row">
                
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/jquery-3.1.1.min.js"></script>
<script src="~/Areas/Manage/Content/js/alertify.js"></script>
<script>
    function OpenPopUp(productid) {
        
        var token = $('input[name="__RequestVerificationToken"]').val();
        $('#PriceBox').modal('show');
      
        jQuery.ajax({
            url: '@Url.Action("ShowOffersList", "ManageOrders")',
            data: { __RequestVerificationToken: token, productid: productid },
            datatype: "json",
            type: "Post",
            

            success: function (d) {
                var textTd='';

                if (d.status == "Success") {

                    $(d.offerslist).each(function(i,data){
                        textTd=textTd+'<tr>';

                        textTd=textTd+'<td>';
                        textTd=textTd+data.Name
                        textTd=textTd+'</td>';
                        textTd=textTd+'<td>';
                        textTd=textTd+data.Family
                        textTd=textTd+'</td>';
                        textTd=textTd+'<td>';
                        textTd=textTd+data.CompanyName
                        textTd=textTd+'</td>';
                        textTd=textTd+'<td>';
                        textTd=textTd+data.Mobile
                        textTd=textTd+'</td>';
                        textTd=textTd+'<td>';
                        textTd=textTd+data.Price
                        textTd=textTd+'</td>';
                      textTd=textTd+  '</tr>';

                     
                   
                    });
                    $("#OffersTable").html(textTd);
                }
                else {
                    alert("error")
                }
              
           

            },


            
            error: function () {
                alert("خطا در دریافت اطلاعات")
            }


        });
    }
    
</script>
